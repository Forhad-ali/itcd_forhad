{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tickets</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body class="bg-light">

<div class="container my-4" style="max-width: 95%;">

  <!-- ===== Compact Status Summary ===== -->
  <div class="card mb-3 shadow-sm">
    <div class="card-body py-2">
      <div class="row text-center g-2">

        <div class="col-6 col-md-3">
          <div class="border border-primary rounded py-2">
            <small>Total</small>
            <h6 class="text-primary mb-0">{{ total_tickets }}</h6>
          </div>
        </div>

        <div class="col-6 col-md-3">
          <div class="border border-warning rounded py-2">
            <small>Open</small>
            <h6 class="text-warning mb-0">{{ open_tickets }}</h6>
          </div>
        </div>

        <div class="col-6 col-md-3">
          <div class="border border-info rounded py-2">
            <small>In Progress</small>
            <h6 class="text-info mb-0">{{ in_progress_tickets }}</h6>
          </div>
        </div>

        <div class="col-6 col-md-3">
          <div class="border border-success rounded py-2">
            <small>Closed</small>
            <h6 class="text-success mb-0">{{ closed_tickets }}</h6>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Ticket List Card ===== -->
  <div class="card shadow-sm">

    <!-- Header -->
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">ğŸ« Ticket List</h4>

      {% if user.role == "admin" or user.role == "manager" %}
        <a href="{% url 'ticket_create' %}" class="btn btn-success btn-sm">
          â• Create Ticket
        </a>
      {% endif %}
    </div>

    <!-- Table -->
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle mb-0">
          <thead class="table-dark small">
            <tr>
              <th>Ticket #</th>
              <th>Title</th>
              <th>Status</th>
              <th>Assigned To</th>
              <th>Created At</th>
              <th>Created By</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody class="small">
          {% for ticket in tickets %}
            <tr style="cursor:pointer;" onclick="window.location='{% url 'ticket_detail' ticket.id %}'">
              <td>{{ ticket.id }}</td>

              <td>
                <a href="{% url 'ticket_detail' ticket.id %}" class="text-decoration-none" onclick="event.stopPropagation();">
                  {{ ticket.title }}
                </a>
              </td>

              <td>
                <span class="badge rounded-pill px-2 py-1
                  {% if ticket.status == 'open' %}bg-warning text-dark
                  {% elif ticket.status == 'in_progress' %}bg-info
                  {% elif ticket.status == 'closed' %}bg-success
                  {% endif %}">
                  {{ ticket.get_status_display }}
                </span>
              </td>

              <td>{{ ticket.assigned_to|default:"â€”" }}</td>
              <td>{{ ticket.created_at|date:"Y-m-d H:i" }}</td>
              <td>{{ ticket.created_by }}</td>

              <td>
                {% if user.role in "admin manager staff" %}
                  <a href="{% url 'ticket_update' ticket.id %}" class="btn btn-primary btn-sm me-1" onclick="event.stopPropagation();">
                    âœï¸ Edit
                  </a>
                {% endif %}

                {% if user.role in "admin manager" %}
                  <a href="{% url 'ticket_delete' ticket.id %}" class="btn btn-danger btn-sm" onclick="event.stopPropagation();">
                    ğŸ—‘ï¸ Delete
                  </a>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="text-center text-muted py-4">
                No tickets found.
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <div class="card-footer bg-white">
      <a href="{% url 'admin_dashboard' %}" class="btn btn-secondary btn-sm">
        â† Back to Dashboard
      </a>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
